<html>
<head>
<meta charset="UTF-8">
</head>
<body>
<style>
div > section{
display:inline;
}
div > section:hover{
background-color: hsl(35,100%,42%);
}
</style>
<h1 style="text-align: center;">Split text</h1>
<input type="checkbox" style="margin-left: 50%;">Split by word (space)</input>
<main style="display: flex;">
<textarea style="box-shadow: 0 0 0px 1px black; border-width: 0px; width:50%;"></textarea>
<div style="float:right; margin-inline-start: 4px;  width:50%;"></div>
</main>
<script>

var p_cnt=1;

function resize(el,ceil){
el.style.maxWidth=(ceil==1)?Math.ceil(document.body.offsetWidth*0.5):Math.floor(document.body.offsetWidth*0.5);
el.style.height=Math.max(window.innerHeight,el.scrollHeight);

document.body.onresize=function(){
el.style.maxWidth=(ceil==1)?Math.ceil(document.body.offsetWidth*0.5):Math.floor(document.body.offsetWidth*0.5);
}
}

var pSpl='';
var wrdSpl='';

wdSpl=document.getElementsByTagName("input")[0];



ebd=document.getElementsByTagName("textarea")[0];
dv=document.getElementsByTagName("div")[0];
var gFontSize=window.getComputedStyle(dv, null).getPropertyValue('font-size');
ebd.style.fontSize=gFontSize;

resize(ebd,0);
resize(dv,1);

dv.oninput=function () {
dv.style.height = 'inherit';
dv.style.height = (dv.scrollHeight+2)+"px";
}

function attached_chars(c,str,n){
let ln='';

for (let i = 0; i < n; i++){
ln+='<br>';
}



var sbs= str.split(c);
for (let i= sbs.length; i-->1;){
    sbs.splice(i, 0, c);
}
for (let i = 0; i < sbs.length-1; i++) {
   if(sbs[i]==c){
   let spr=[...sbs[i+1]];
	   for (let k = 0; k < spr.length; k++) {
		   if(spr[k]==" "){
		   spr[k]=ln+spr[k];
		   k=spr.length-1;
		   }
	   }
	   sbs[i+1]=spr.join('');
	   i=i+1;
   }
}
		return sbs.join('');
}

function changer(){
let tmp='';
ebd.style.height = 'inherit';
ebd.style.height = (dv.scrollHeight+2)+"px";
dv.innerHTML=ebd.value;
p_cnt=1;
if(ebd.value!=''){
let itd=ebd.value.split('\n');
tmp='¶{'+p_cnt+'}<section><br>';
p_cnt++;
let first = -1;

for (let k = 0; k < itd.length; k++) {
if (!(itd[k].split(' ').join('')=="")){
first=k;
break;
}
}

function brk(ln){
	ln=attached_chars('.',ln,2);
	ln=attached_chars('?',ln,2);
	ln=attached_chars('!',ln,2);
	ln=attached_chars(':',ln,1);
	ln=attached_chars(';',ln,1);
	ln=attached_chars(',',ln,1);
	return ln;
}

for (let k = 0; k < itd.length; k++) {		
	if(k<itd.length-1){
	if ((itd[k].split(' ').join('')=="")&&!(itd[k+1].split(' ').join('')=="")&&(k>=first)){
	itd[k]='</section>⁋<br><br>¶{'+p_cnt+'}<section>';
	p_cnt++;
	}else{
	itd[k]=brk(itd[k]);
	}
	}else{
	itd[k]=brk(itd[k]);		
	}
}
tmp+=itd.join('<br>');
tmp+='<br></section>⁋';


}
pSpl=tmp;
wrdSpl=pSpl.split('<br>').join('<br><br>');
for (let k = 1; k <=p_cnt ; k++) {	
wrdSpl=wrdSpl.split('¶{'+k+'}<section><br><br>').join('¶{'+k+'}<section><br>');
}
wrdSpl=wrdSpl.split('<br><br></section>⁋').join('<br></section>⁋').split('</section>⁋<br><br><br><br>¶').join('</section>⁋<br><br><br>\¶').split(' ').join('<br>');
dv.innerHTML=(!wdSpl.checked)?tmp:wrdSpl;
dv.style.fontSize=(!wdSpl.checked)?gFontSize:"194%";
}
ebd.oninput=function(){
changer();
}
ebd.onchange=function(){
changer();
}

wdSpl.oninput=function(){
dv.innerHTML=(!wdSpl.checked)?pSpl:wrdSpl;
dv.style.fontSize=(!wdSpl.checked)?gFontSize:"194%";
}

</script>
</body>
</html>
